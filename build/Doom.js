/*

 Doom.js Library
 Version: 1.0.0
 Copyright (c) 2015 Iain Shorter 
 Licensed under MIT license

 Javascript framework to simplify high level JS -> DOM interaction including:
 - Touch gestures
 - Tree based multi node creation
 - Hybrid JS/HTML element definition and creation

*/
(function(l){if(!("classList"in document.createElement("_"))&&"Element"in l){l=l.Element.prototype;var h=Object,m=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},p=Array.prototype.indexOf||function(b){for(var c=0,d=this.length;c<d;c++)if(c in this&&this[c]===b)return c;return-1},b=function(b,c){this.name=b;this.code=DOMException[b];this.message=c},d=function(c,d){if(""===d)throw new b("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(d))throw new b("INVALID_CHARACTER_ERR",
"String contains an invalid character");return p.call(c,d)},e=function(c){for(var b=m.call(c.getAttribute("class")||""),b=b?b.split(/\s+/):[],d=0,e=b.length;d<e;d++)this.push(b[d]);this._updateClassName=function(){c.setAttribute("class",this.toString())}},c=e.prototype=[],t=function(){return new e(this)};b.prototype=Error.prototype;c.item=function(b){return this[b]||null};c.contains=function(b){return-1!==d(this,b+"")};c.add=function(b){b+="";-1===d(this,b)&&(this.push(b),this._updateClassName())};
c.remove=function(b){var c;b+="";for(c=d(this,b);-1!==c;)this.splice(c,1),this._updateClassName(),c=d(this,b)};c.toggle=function(b){b+="";var c=this.contains(b);this[c?"remove":"add"](b);return!c};c.toString=function(){return this.join(" ")};if(h.defineProperty){c={get:t,enumerable:!0,configurable:!0};try{h.defineProperty(l,"classList",c)}catch(u){-2146823252===u.number&&(c.enumerable=!1,h.defineProperty(l,"classList",c))}}else h.prototype.__defineGetter__&&l.__defineGetter__("classList",t)}})(self);
(function(){function l(b){function d(){g=null;f.x=null;f.y=null;f.t=null;a.event=null;a.gesture=null;a.pos_t_start=null;a.pos_t_previous=null;a.pos_t_end=null;a.pos_t_delta=null;a.pos_x_start=null;a.pos_x_previous=null;a.pos_x_end=null;a.pos_x_delta=null;a.pos_y_start=null;a.pos_y_previous=null;a.pos_y_end=null;a.pos_y_delta=null;a.pos_u_delta=null;a.vel_x=null;a.vel_y=null;a.vel_u=null;a.dist_x=null;a.dist_y=null;a.dist_u=null;a.direction=null;clearTimeout(r);r=null}function e(){f.x=g.pageX||g.changedTouches[0].pageX;
f.y=g.pageY||g.changedTouches[0].pageY;f.t=g.timeStamp}function c(b){g||(a.event=g=b,e(),a.pos_t_start=f.t,a.pos_x_start=f.x,a.pos_y_start=f.y,a.pos_t_delta=0,a.pos_x_delta=0,a.pos_y_delta=0,a.pos_u_delta=0,r=setTimeout(p,n.HOLD_MINTIME),k.event("touchstart",a))}function l(b){if(g){var c;a.event=g=b;a.pos_t_previous=f.t;a.pos_x_previous=f.x;a.pos_y_previous=f.y;e();a.pos_t_delta=f.t-a.pos_t_start;b=f.x-a.pos_x_previous;c=f.y-a.pos_y_previous;a.pos_x_delta+=Math.abs(b);a.pos_y_delta+=Math.abs(c);a.pos_u_delta+=
Math.sqrt(b*b+c*c);a.dist_x=f.x-a.pos_x_start;a.dist_y=f.y-a.pos_y_start;a.dist_u=Math.sqrt(a.dist_x*a.dist_x+a.dist_y*a.dist_y);a.vel_x=a.dist_x/a.pos_t_delta;a.vel_y=a.dist_y/a.pos_t_delta;a.vel_u=a.dist_u/a.pos_t_delta;k.event("touchmove",a);a.pos_u_delta>n.PAN_MINDELTA&&(Math.abs(a.dist_x)>Math.abs(a.dist_y)?(a.direction=0<b?"RIGHT":"LEFT",k.event("pan"+a.direction.toLowerCase(),a),k.event("panhorizontal",a)):(a.direction=0<c?"DOWN":"UP",k.event("pan"+a.direction.toLowerCase(),a),k.event("panvertical",
a)),k.event("pan",a))}}function h(b){if(g){var c;a.event=g=b;e();a.pos_t_end=f.t;a.pos_x_end=f.x;a.pos_y_end=f.y;a.pos_t_delta=f.t-a.pos_t_start;b=null===a.pos_x_previous?0:f.x-a.pos_x_previous;c=null===a.pos_y_previous?0:f.y-a.pos_y_previous;a.pos_x_delta+=Math.abs(b);a.pos_y_delta+=Math.abs(c);a.pos_u_delta+=Math.sqrt(b*b+c*c);a.dist_x=f.x-a.pos_x_start;a.dist_y=f.y-a.pos_y_start;a.dist_u=Math.sqrt(a.dist_x*a.dist_x+a.dist_y*a.dist_y);a.vel_x=a.dist_x/a.pos_t_delta;a.vel_y=a.dist_y/a.pos_t_delta;
a.vel_u=a.dist_u/a.pos_t_delta;k.event("touchend",a);"mouseleave"!==g.type&&"touchleave"!==g.type&&a.pos_t_delta<n.TAP_MAXTIME&&a.pos_u_delta<n.TAP_MAXDELTA&&(k.event("tap",a),g.preventDefault());a.pos_t_delta<n.SWIPE_MAXTIME&&a.vel_u>n.SWIPE_MINSPEED&&(Math.abs(a.dist_x)>Math.abs(a.dist_y)?(a.direction=0<a.dist_x?"RIGHT":"LEFT",k.event("swipe"+a.direction.toLowerCase(),a),k.event("swipehorizontal",a)):(a.direction=0<a.dist_y?"DOWN":"UP",k.event("swipe"+a.direction.toLowerCase(),a),k.event("swipevertical",
a)),k.event("swipe",a));d()}}function m(a){g&&n.END_ON_LEAVE&&h(a)}function p(){g&&(e(),a.pos_t_delta=f.t-a.pos_t_start,a.dist_u&&(a.vel_x=a.dist_x/a.pos_t_delta,a.vel_y=a.dist_y/a.pos_t_delta,a.vel_u=a.dist_u/a.pos_t_delta),a.pos_u_delta<n.HOLD_MAXDELTA&&k.event("hold",a))}function s(){b.addEventListener("touchstart",c,!1);b.addEventListener("mousedown",c,!1);b.addEventListener("touchmove",l,!1);b.addEventListener("mousemove",l,!1);b.addEventListener("touchleave",m,!1);b.addEventListener("mouseleave",
m,!1);document.body.addEventListener("touchcancel",h,!1);document.body.addEventListener("mouseup",h,!1);document.body.addEventListener("touchend",h,!1)}var k=this,g=null,r=null,q=b.style,n={TAP_MAXTIME:500,TAP_MAXDELTA:20,PAN_MINDELTA:20,HOLD_MINTIME:1E3,HOLD_MAXDELTA:20,SWIPE_MAXTIME:400,SWIPE_MINSPEED:1,END_ON_LEAVE:!1},f={x:null,y:null,t:null},a={pos:f,event:null,preventDefault:function(){g&&g.cancellable&&g.preventDefault()},stopProgagation:function(){g&&g.stopProgagation&&g.stopProgagation()}};
q.webkitUserSelect="none";q.mozUserSelect="none";q.msUserSelect="none";q.webkitUserDrag="none";q.webkitTapHighlightColor="rgba(0,0,0,0)";d();s();this.__eventlist__={};this.detach=function(){b.removeEventListener("touchstart",c,!1);b.removeEventListener("mousedown",c,!1);b.removeEventListener("touchmove",l,!1);b.removeEventListener("mousemove",l,!1);b.removeEventListener("touchleave",m,!1);b.removeEventListener("mouseleave",m,!1);document.body.removeEventListener("touchcancel",h,!1);document.body.removeEventListener("mouseup",
h,!1);document.body.removeEventListener("touchend",h,!1)};this.attach=s;this.element=b;this.CONFIG=n;b.touches=this}function h(b){var d,e,c;if("object"!==typeof b)throw Error("Element object structure is not defined");if("string"===typeof b.alloyName)if(e=b.alloyName,c=b.alloyProperties||{},p[e])c=new p[e](c),c.alloyName=e,c.element.alloy=c,c=c.element;else throw Error("Construction Error, alloy does not exist");else c="string"===typeof b.tagName?document.createElement(b.tagName):document.createElement("div");
for(d in b)switch(e=b[d],d){case "tagName":case "alloyName":case "alloyProperties":case "copies":break;case "ontap":m(c,"tap",e);break;case "onswipe":m(c,"swipe",e);break;case "onpan":m(c,"pan",e);break;case "parentNode":e.appendChild(c);break;case "style":if("object"===typeof e)for(d in e)c.style[d]=e[d];else if("string"===typeof e)c.style.cssText=e;else throw Error("Style TypeError - "+typeof e);break;case "dataset":for(d in e)c.dataset[d]=e[d];break;case "childNodes":for(d=0;d<e.length;d++)if(e[d]instanceof
HTMLElement)c.appendChild(e[d]);else if("object"===typeof e[d])e[d].parentNode=c,e[d]=h(e[d]);else throw Error("Child "+d+" TypeError - "+typeof e[d]);break;case "childNode":if(e instanceof HTMLElement)c.appendChild(e);else if("object"===typeof e)e.parentNode=c,h(e);else throw Error("Child TypeError - "+typeof e);break;default:c[d]=e}return c}function m(b,d,e){b.touches||new l(b);if(d&&d.constructor===Array)for(var c=0,h=d.length;c<h;c++)b.touches.on(d[c],e);else b.touches.on(d,e)}var p={};l.prototype=
{on:function(b,d){this.__eventlist__[b.toLowerCase()]=d},event:function(b,d){if("function"===typeof this.__eventlist__[b]){d.gesture=b;try{this.__eventlist__[b].call(this,d)}catch(e){console.warn(e.stack||e)}}}};window.Doom={create:h,modify:function(b){var d=b.element,e,c;if(!d)throw Error("Element not defined");for(c in b)switch(e=b[c],c){case "tagName":case "alloyName":case "alloyProperties":case "copies":break;case "ontap":m(d,"tap",e);break;case "onswipe":m(d,"swipe",e);break;case "onpan":m(d,
"pan",e);break;case "parentNode":e.appendChild(d);break;case "addClass":d.classList.add(e);break;case "toggleClass":d.classList.toggle(e);break;case "removeClass":d.classList.remove(e);break;case "dataset":for(c in e)d.dataset[c]=e[c];break;case "style":if("object"===typeof e)for(c in b.style)d.style[c]=b.style[c];else if("string"===typeof b.style)d.style.cssText+=b.style;else throw Error("Style TypeError - "+typeof b.style);break;case "innerHTML":d[c]!==b[c]&&(d[c]=b[c]);break;case "removeChild":"number"===
typeof b[c]?d.removeChild(d.childNodes[b[c]]):d.removeChild(b[c]);break;case "removeChildren":for(e=b[c].length;c--;)"number"===typeof b[c][e]&&(b[c][e]=d.childNodes[b[c][e]]);for(e=b[c].length;c--;)d.removeChild(b[c][e]);break;case "appendChild":break;case "childNodes":for(;d.firstChild;)d.removeChild(d.firstChild);for(c=0;c<b.childNodes.length;c++)if(b.childNodes[c]instanceof HTMLElement)d.appendChild(b.childNodes[c]);else if("object"==typeof b.childNodes[c])b.childNodes[c].parentNode=d,b.childNodes[c]=
h(b.childNodes[c]);else throw Error("Child "+c+" TypeError - "+typeof b.childNodes[c]);break;default:d[c]=b[c]}return d},search:function(b,d){d=d||document;switch(b.charAt(0)){case ".":return d.getElementsByClassName(b.substr(1));case "#":return d.getElementById(b.substr(1));case "?":return d.querySelectorAll(b.substr(1));default:return d.getElementsByTagName(b)}},remove:function(b){b.parentNode&&b.parentNode.removeChild(b);return b},define:function(b,d){b=b.toLowerCase();if(p[b])throw Error("Definition Error, alloy already exists!");
p[b]=d},touch:m}})();
