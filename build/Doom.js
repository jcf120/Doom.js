/* Doom.js Library Version: 1.2.0 Copyright (c) 2015 Iain Shorter */window.Doom = {}; (function() {'use strict';if(!("classList"in document.createElement("_"))&&"Element"in window){var classListProp="classList",protoProp="prototype",elemCtrProto=window.Element[protoProp],objCtr=Object,strTrim=String[protoProp].trim||function(){return this.replace(/^\s+|\s+$/g,"")},arrIndexOf=Array[protoProp].indexOf||function(b){for(var a=0,d=this.length;a<d;a++)if(a in this&&this[a]===b)return a;return-1},DOMEx=function(b,a){this.name=b;this.code=DOMException[b];this.message=a},checkTokenAndGetIndex=function(b,a){if(""===
a)throw new DOMEx("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(a))throw new DOMEx("INVALID_CHARACTER_ERR","String contains an invalid character");return arrIndexOf.call(b,a)},ClassList=function(b){for(var a=strTrim.call(b.getAttribute("class")||""),a=a?a.split(/\s+/):[],d=0,e=a.length;d<e;d++)this.push(a[d]);this._updateClassName=function(){b.setAttribute("class",this.toString())}},classListProto=ClassList[protoProp]=[],classListGetter=function(){return new ClassList(this)};
DOMEx[protoProp]=Error[protoProp];classListProto.item=function(b){return this[b]||null};classListProto.contains=function(b){return-1!==checkTokenAndGetIndex(this,b+"")};classListProto.add=function(b){b+="";-1===checkTokenAndGetIndex(this,b)&&(this.push(b),this._updateClassName())};classListProto.remove=function(b){var a;b+="";for(a=checkTokenAndGetIndex(this,b);-1!==a;)this.splice(a,1),this._updateClassName(),a=checkTokenAndGetIndex(this,b)};classListProto.toggle=function(b){b+="";var a=this.contains(b);
this[a?"remove":"add"](b);return!a};classListProto.toString=function(){return this.join(" ")};if(objCtr.defineProperty){var classListPropDesc={get:classListGetter,enumerable:!0,configurable:!0};try{objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc)}catch(ex){-2146823252===ex.number&&(classListPropDesc.enumerable=!1,objCtr.defineProperty(elemCtrProto,classListProp,classListPropDesc))}}else objCtr[protoProp].__defineGetter__&&elemCtrProto.__defineGetter__(classListProp,classListGetter)};if(!Promise in window){var Promise=function(b){if(this instanceof Promise)this.state=STATE_INIT,this.subscriberqueue=[],this.settledValue=this.resolvehandler=this.rejectionhandler=void 0,b!==INTERNAL&&this.resolveWithResolver(b);else return new Promise(b)},deferredThrow=function(b){setTimeout(function(){throw b;},0)},tryCatch=function(b){return function(a,d){try{return b(a,d)}catch(e){return errorObj.e=e,errorObj}}},errorObj={e:null},STATE_INIT=0,STATE_PEND=1,STATE_RSLV=2,STATE_RJCT=3,INTERNAL=function(){};
Promise.prototype={resolveWithResolver:function(b){var a=this;this.state=STATE_PEND;b=tryCatch(b)(function(d){null!==a&&(a.resolveCallback(d),a=null)},function(d){null!==a&&(a.rejectCallback(d),a=null)});void 0!==b&&null!==a&&(a.rejectCallback(b.e),a=null)},resolveCallback:function(b){var a=this;b instanceof Promise?b.then(function(d){null!==a&&(a.resolveCallback(d),a=null)},function(d){null!==a&&(a.rejectCallback(d),a=null)}):(this.state=STATE_RSLV,this.resolvehandler?(b=tryCatch(this.resolvehandler)(b),
b===errorObj?a.reject(b.e):b instanceof Promise?b.then(function(d){null!==a&&(a.fulfill(d),a=null)},function(d){null!==a&&(a.reject(d),a=null)}):a.fulfill(b)):this.fulfill(b))},rejectCallback:function(b){var a=this;b instanceof Promise?b.then(function(d){null!==a&&(a.resolveCallback(d),a=null)},function(d){null!==a&&(a.rejectCallback(d),a=null)}):(this.state=STATE_RJCT,this.rejectionhandler?(b=tryCatch(this.rejectionhandler)(b),b===errorObj?(a.reject(b.e),a=null):b instanceof Promise?b.then(function(d){a.fulfill(d);
a=null},function(d){a.reject(d);a=null}):(a.fulfill(b),a=null)):this.reject(b))},fulfill:function(b){for(var a=this,d;this.subscriberqueue.length;)d=this.subscriberqueue.shift(),setTimeout(function(){d.resolveCallback(b);a.settledValue=b},0)},reject:function(b,a){for(var d=this,e;this.subscriberqueue.length;)e=this.subscriberqueue.shift(),setTimeout(function(){e.rejectCallback(b);d.settledValue=b},0)},then:function(b,a){var d=new Promise(INTERNAL);d.resolvehandler=b;d.rejectionhandler=a;this.subscriberqueue.push(d);
this.settledValue&&(this.state===STATE_RSLV?this.fulfill(this.settledValue):this.reject(this.settledValue));return d},catch:function(b){return this.then(void 0,b)}}}Doom.Promise=Promise;Element.prototype.contains||(Element.prototype.contains=function(b){return!!(this.compareDocumentPosition(b)&16)});var alloys={};function createAlloy(b,a){if(alloys[b]){var d=new alloys[b](a);d.alloyName=b;d.element.alloy=d;return d.element}throw Error("Construction Error, alloy does not exist");}Doom.define=function(b,a){b=b.toLowerCase();if(alloys[b])throw Error("Definition Error, alloy already exists!");alloys[b]=a};(function(){function b(d){var b,f;if("object"!==typeof d)throw Error("Element object structure is not defined");f="string"===typeof d.alloyName?createAlloy(d.alloyName,d.alloyProperties||{}):document.createElement(d.tagName||"div");for(b in d)b in a?a[b].apply(f,[d[b]]):f[b]=d[b];return f}var a={};a.tagName=a.alloyName=a.alloyProperties=a.copies=function(){};a.onTap=a.ontap=function(a){return Doom.touch(this,"tap",a)};a.onSwipe=a.onswipe=function(a){return Doom.touch(this,"swipe",a)};a.onhold=a.onHold=
function(a){return Doom.touch(this,"hold",a)};a.onpan=a.onPan=function(a){return Doom.touch(this,"pan",a)};a.parentNode=a.parent=function(a){return a.appendChild(this)};a.insertBefore=function(a){a.parentNode.insertBefore(this,a)};a.insertAfter=function(a){a.parentNode.insertBefore(this,a.nextSibling)};a.style=function(a){if("object"===typeof a)for(var b in a)this.style[b]=a[b];else if("string"===typeof a)this.style.cssText=a;else throw Error("Style TypeError - "+typeof a);};a.childNodes=a.children=
function(d){for(var b=0;b<d.length;b++)d[b]=a.child.apply(this,[d[b]]);return d};a.child=function(a){if(a instanceof HTMLElement)this.appendChild(a);else if("object"===typeof a)a.parentNode=this,a=b(a);else throw Error("Child TypeError - "+typeof a);return a};a.dataset=function(a){for(var b in a)this.dataset[b]=a[b]};Doom.create=b})();function Service(){this.delegates=[];this.eventlist={}}
Service.prototype={on:function(b,a){this.eventlist[b]=a},fire:function(b,a){"function"===typeof this.eventlist[b]&&this.eventlist[b].call(this,a)},register:function(b){b=new Delegate(this,b);this.delegates.push(b);1===this.delegates.length&&this.fire("start");this.fire("register",b);return b},deregister:function(b){var a=this.delegates.indexOf(b);this.delegates.splice(a,1);this.fire("deregister",b);0===this.delegates.length&&this.fire("stop")},callDelegates:function(b,a){for(var d=this.delegates.length;d--;)this.delegates[d].fire(b,
a)}};function Delegate(b,a){this.eventlist={};this.service=b;this.context=a}Delegate.prototype={on:function(b,a){this.eventlist[b]=a;this.service.fire("listen",[b,this])},fire:function(b,a){"function"===typeof this.eventlist[b]&&this.eventlist[b].call(this.context,a)}};Doom.service=function(){return new Service};(function(){function b(a){var d=[];for(i in a)d.push(i+"="+escape(encodeURI(a[i])));return d.join("&")}function a(a,b){for(var l in d.headers)void 0===b[l]&&(b[l]=d.headers[l]);for(l in b)a.setRequestHeader(l,b[l])}var d={method:"GET",encode:"json",timeout:0,credentials:!0,headers:{Accept:"*/*","Content-type":"application/json;charset=UTF-8"}};Doom.fetch=function(e){return new Doom.Promise(function(f,l){var k=new XMLHttpRequest,q=e.encode||d.encode,s=e.timeout||d.timeout,m=e.withCredentials||d.credentials,
g=e.headers||{};k.open(e.method||d.method,"string"===typeof e?e:e.url);k.timeout=s;k.withCredentials=m;a(k,g);k.onload=function(){400>k.status&&200<=k.status?f(k.response):l(k)};k.onerror=function(){l(k)};k.onabort=function(){l(k)};"json"===q?k.send(e.data?JSON.stringify(e.data):null):"url"===q&&k.send(e.data?b(e.data):null)})};Doom.fetch.DEFAULTS=d})();(function(){function b(d){var e=d.element,f;if(!e)throw Error("Element not defined");if(d.delay)f=d.delay,d.delay=null,setTimeout(b,f,d);else{for(f in d)f in a?a[f].apply(e,[d[f]]):e[f]=d[f];return e}}var a={};a.tagName=a.alloyName=a.alloyProperties=a.copies=function(){};a.onTap=a.ontap=function(a){return Doom.touch(this,"tap",a)};a.onSwipe=a.onswipe=function(a){return Doom.touch(this,"swipe",a)};a.onhold=a.onHold=function(a){return Doom.touch(this,"hold",a)};a.onpan=a.onPan=function(a){return Doom.touch(this,
"pan",a)};a.parentNode=a.parent=function(a){return a.appendChild(this)};a.insertBefore=function(a){a.parentNode.insertBefore(this,a)};a.insertAfter=function(a){a.parentNode.insertBefore(this,a.nextSibling)};a.style=function(a){if("object"===typeof a)for(var b in a)this.style[b]=a[b];else if("string"===typeof a)this.style.cssText+=a;else throw Error("Style TypeError - "+typeof a);};a.addClass=function(a){this.classList.add(a)};a.toggleClass=function(a){this.classList.toggle(a)};a.removeClass=function(a){this.classList.remove(a)};
a.childNodes=a.children=function(b){for(;this.firstChild;)this.removeChild(this.firstChild);for(var e=0;e<b.length;e++)b[e]=a.child.apply(this,[b[e]]);return b};a.child=function(a){for(;this.firstChild;)this.removeChild(this.firstChild);if(a instanceof HTMLElement)this.appendChild(a);else if("string"===typeof a)for(var b=Doom.create({innerHTML:a});b.firstChild;)this.appendChild(b.firstChild);else if("object"===typeof a)a.parentNode=this,a=Doom.create(a);else throw Error("Child TypeError - "+typeof prop);
return a};a.removeChild=function(a){"number"===typeof a?this.removeChild(this.childNodes[a]):this.removeChild(a)};a.removeChildren=a.removeChildNodes=function(a){for(var b=a.length;b--;)"number"===typeof a[b]&&(a[b]=this.childNodes[a[b]]);for(n=a.length;b--;)this.removeChild(a[b])};a.innerHTML=function(a){this.innerHTML!==a&&(this.innerHTML=a)};a.dataset=function(a){for(var b in prop)element.dataset[b]=prop[b]};Doom.modify=b})();Doom.remove=function(b){b.parentNode&&b.parentNode.removeChild(b);return b};Doom.search=function(b,a){a=a||document;switch(b.charAt(0)){case ".":return a.getElementsByClassName(b.substr(1));case "#":return a.getElementById(b.substr(1));case "?":return a.querySelectorAll(b.substr(1));default:return a.getElementsByTagName(b)}};(function(){function b(a){function b(){g=null;h.x=null;h.y=null;h.t=null;c.event=null;c.gesture=null;c.pos_t_start=null;c.pos_t_previous=null;c.pos_t_end=null;c.pos_t_delta=null;c.pos_x_start=null;c.pos_x_previous=null;c.pos_x_end=null;c.pos_x_delta=null;c.pos_y_start=null;c.pos_y_previous=null;c.pos_y_end=null;c.pos_y_delta=null;c.pos_u_delta=null;c.vel_x=null;c.vel_y=null;c.vel_u=null;c.dist_x=null;c.dist_y=null;c.dist_u=null;c.direction=null;clearTimeout(t);t=null}function e(){h.x=g.pageX||g.changedTouches[0].pageX;
h.y=g.pageY||g.changedTouches[0].pageY;h.t=g.timeStamp}function f(a){g||(c.event=g=a,e(),c.pos_t_start=h.t,c.pos_x_start=h.x,c.pos_y_start=h.y,c.pos_t_delta=0,c.pos_x_delta=0,c.pos_y_delta=0,c.pos_u_delta=0,t=setTimeout(s,p.HOLD_MINTIME),m.event("touchstart",c))}function l(a){if(g){var b;c.event=g=a;c.pos_t_previous=h.t;c.pos_x_previous=h.x;c.pos_y_previous=h.y;e();c.pos_t_delta=h.t-c.pos_t_start;a=h.x-c.pos_x_previous;b=h.y-c.pos_y_previous;c.pos_x_delta+=Math.abs(a);c.pos_y_delta+=Math.abs(b);c.pos_u_delta+=
Math.sqrt(a*a+b*b);c.dist_x=h.x-c.pos_x_start;c.dist_y=h.y-c.pos_y_start;c.dist_u=Math.sqrt(c.dist_x*c.dist_x+c.dist_y*c.dist_y);c.vel_x=c.dist_x/c.pos_t_delta;c.vel_y=c.dist_y/c.pos_t_delta;c.vel_u=c.dist_u/c.pos_t_delta;m.event("touchmove",c);c.pos_u_delta>p.PAN_MINDELTA&&(Math.abs(c.dist_x)>Math.abs(c.dist_y)?(c.direction=0<a?"RIGHT":"LEFT",m.event("pan"+c.direction.toLowerCase(),c),m.event("panhorizontal",c)):(c.direction=0<b?"DOWN":"UP",m.event("pan"+c.direction.toLowerCase(),c),m.event("panvertical",
c)),m.event("pan",c))}}function k(a){if(g){var f;c.event=g=a;e();c.pos_t_end=h.t;c.pos_x_end=h.x;c.pos_y_end=h.y;c.pos_t_delta=h.t-c.pos_t_start;a=null===c.pos_x_previous?0:h.x-c.pos_x_previous;f=null===c.pos_y_previous?0:h.y-c.pos_y_previous;c.pos_x_delta+=Math.abs(a);c.pos_y_delta+=Math.abs(f);c.pos_u_delta+=Math.sqrt(a*a+f*f);c.dist_x=h.x-c.pos_x_start;c.dist_y=h.y-c.pos_y_start;c.dist_u=Math.sqrt(c.dist_x*c.dist_x+c.dist_y*c.dist_y);c.vel_x=c.dist_x/c.pos_t_delta;c.vel_y=c.dist_y/c.pos_t_delta;
c.vel_u=c.dist_u/c.pos_t_delta;m.event("touchend",c);"mouseleave"!==g.type&&"touchleave"!==g.type&&c.pos_t_delta<p.TAP_MAXTIME&&c.pos_u_delta<p.TAP_MAXDELTA&&(m.event("tap",c),p.PREVENT_DBL_CLICK&&g.preventDefault());c.pos_t_delta<p.SWIPE_MAXTIME&&c.vel_u>p.SWIPE_MINSPEED&&(Math.abs(c.dist_x)>Math.abs(c.dist_y)?(c.direction=0<c.dist_x?"RIGHT":"LEFT",m.event("swipe"+c.direction.toLowerCase(),c),m.event("swipehorizontal",c)):(c.direction=0<c.dist_y?"DOWN":"UP",m.event("swipe"+c.direction.toLowerCase(),
c),m.event("swipevertical",c)),m.event("swipe",c));b()}}function q(a){g&&p.END_ON_LEAVE&&k(a)}function s(){g&&(e(),c.pos_t_delta=h.t-c.pos_t_start,c.dist_u&&(c.vel_x=c.dist_x/c.pos_t_delta,c.vel_y=c.dist_y/c.pos_t_delta,c.vel_u=c.dist_u/c.pos_t_delta),c.pos_u_delta<p.HOLD_MAXDELTA&&m.event("hold",c))}var m=this,g=null,t=null,r=a.style,p={TAP_MAXTIME:500,TAP_MAXDELTA:20,PAN_MINDELTA:20,HOLD_MINTIME:1E3,HOLD_MAXDELTA:20,SWIPE_MAXTIME:400,SWIPE_MINSPEED:1,END_ON_LEAVE:!1,PREVENT_DBL_CLICK:!1,TOUCH:"ontouchstart"in
window,MOUSE:!0},h={x:null,y:null,t:null},c={pos:h,event:null,preventDefault:function(){g&&g.cancellable&&g.preventDefault()},stopProgagation:function(){g&&g.stopProgagation&&g.stopProgagation()},childIndex:function(b){b=b||a;for(var c=-1,d=0,e=b.children.length;d<e;d++)if(b.children[d].contains(g.target)){c=d;break}return c},childNode:function(b){b=b||a;for(var c,d=0,e=b.children.length;d<e;d++)if(b.children[d].contains(g.target)){c=b.children[d];break}return c},element:a};this.detach=function(){p.TOUCH&&
(a.removeEventListener("touchstart",f,!1),a.removeEventListener("touchmove",l,!1),document.body.removeEventListener("touchcancel",k,!1),document.body.removeEventListener("touchend",k,!1),a.removeEventListener("touchleave",q,!1));p.MOUSE&&(a.removeEventListener("mousedown",f,!1),a.removeEventListener("mousemove",l,!1),document.body.removeEventListener("mouseup",k,!1),a.removeEventListener("mouseleave",q,!1))};this.attach=function(){p.TOUCH&&(a.addEventListener("touchstart",f,!1),a.addEventListener("touchmove",
l,!1),document.body.addEventListener("touchcancel",k,!1),document.body.addEventListener("touchend",k,!1),a.addEventListener("touchleave",q,!1));p.MOUSE&&(a.addEventListener("mousedown",f,!1),a.addEventListener("mousemove",l,!1),document.body.addEventListener("mouseup",k,!1),a.addEventListener("mouseleave",q,!1))};r.webkitUserSelect="none";r.mozUserSelect="none";r.msUserSelect="none";r.webkitUserDrag="none";r.webkitTapHighlightColor="rgba(0,0,0,0)";b();this.attach();this.__eventlist__={};this.element=
a;this.CONFIG=p;a.touches=this}b.prototype={on:function(a,b){"tap"===a&&(this.CONFIG.PREVENT_DBL_CLICK=!0);this.__eventlist__[a.toLowerCase()]=b},event:function(a,b){if("function"===typeof this.__eventlist__[a]){b.gesture=a;try{this.__eventlist__[a].call(this,b)}catch(e){console.error(e.stack||e)}}}};Doom.touch=function(a,d,e){a.touches||new b(a);if(d&&d.constructor===Array)for(var f=0,l=d.length;f<l;f++)a.touches.on(d[f],e);else a.touches.on(d,e);return a.touches}})();})();
