/*

 Doom.js Library
 Version: 1.0.0
 Copyright (c) 2015 Iain Shorter 
 Licensed under MIT license

 Javascript framework to simplify high level JS -> DOM interaction including:
 - Touch gestures
 - Tree based multi node creation
 - Hybrid JS/HTML element definition and creation

*/
(function(k){if(!("classList"in document.createElement("_"))&&"Element"in k){k=k.Element.prototype;var h=Object,m=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},l=Array.prototype.indexOf||function(c){for(var a=0,d=this.length;a<d;a++)if(a in this&&this[a]===c)return a;return-1},c=function(a,c){this.name=a;this.code=DOMException[a];this.message=c},d=function(a,d){if(""===d)throw new c("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(d))throw new c("INVALID_CHARACTER_ERR",
"String contains an invalid character");return l.call(a,d)},e=function(a){for(var c=m.call(a.getAttribute("class")||""),c=c?c.split(/\s+/):[],d=0,e=c.length;d<e;d++)this.push(c[d]);this._updateClassName=function(){a.setAttribute("class",this.toString())}},a=e.prototype=[],q=function(){return new e(this)};c.prototype=Error.prototype;a.item=function(a){return this[a]||null};a.contains=function(a){return-1!==d(this,a+"")};a.add=function(a){a+="";-1===d(this,a)&&(this.push(a),this._updateClassName())};
a.remove=function(a){var c;a+="";for(c=d(this,a);-1!==c;)this.splice(c,1),this._updateClassName(),c=d(this,a)};a.toggle=function(a){a+="";var c=this.contains(a);this[c?"remove":"add"](a);return!c};a.toString=function(){return this.join(" ")};if(h.defineProperty){a={get:q,enumerable:!0,configurable:!0};try{h.defineProperty(k,"classList",a)}catch(r){-2146823252===r.number&&(a.enumerable=!1,h.defineProperty(k,"classList",a))}}else h.prototype.__defineGetter__&&k.__defineGetter__("classList",q)}})(self);
(function(){function k(c){function d(){g=null;f.x=null;f.y=null;f.t=null;b.event=null;b.pos_t_start=null;b.pos_t_previous=null;b.pos_t_end=null;b.pos_t_delta=null;b.pos_x_start=null;b.pos_x_previous=null;b.pos_x_end=null;b.pos_x_delta=null;b.pos_y_start=null;b.pos_y_previous=null;b.pos_y_end=null;b.pos_y_delta=null;b.pos_u_delta=null;b.vel_x=null;b.vel_y=null;b.vel_u=null;b.dist_x=null;b.dist_y=null;b.dist_u=null;b.direction=null}function e(){f.x=g.pageX||g.changedTouches[0].pageX;f.y=g.pageY||g.changedTouches[0].pageY;
f.t=g.timeStamp}function a(a){g||(b.event=g=a,e(),b.pos_t_start=f.t,b.pos_x_start=f.x,b.pos_y_start=f.y,b.pos_t_delta=0,b.pos_x_delta=0,b.pos_y_delta=0,b.pos_u_delta=0,l.event("touchstart",b))}function k(a){if(g){var c;b.event=g=a;b.pos_t_previous=f.t;b.pos_x_previous=f.x;b.pos_y_previous=f.y;e();b.pos_t_delta=f.t-b.pos_t_start;a=f.x-b.pos_x_previous;c=f.y-b.pos_y_previous;b.pos_x_delta+=Math.abs(a);b.pos_y_delta+=Math.abs(c);b.pos_u_delta+=Math.sqrt(a*a+c*c);b.dist_x=f.x-b.pos_x_start;b.dist_y=f.y-
b.pos_y_start;b.dist_u=Math.sqrt(b.dist_x*b.dist_x+b.dist_y*b.dist_y);b.vel_x=b.dist_x/b.pos_t_delta;b.vel_y=b.dist_y/b.pos_t_delta;b.vel_u=b.dist_u/b.pos_t_delta;l.event("touchmove",b);b.pos_u_delta>n.PAN_MINDELTA&&(Math.abs(b.dist_x)>Math.abs(b.dist_y)?b.direction=0<b.dist_x?"RIGHT":"LEFT":b.direction=0<b.dist_y?"DOWN":"UP",l.event("pan",b))}}function h(a){if(g){var c;b.event=g=a;e();b.pos_t_end=f.t;b.pos_x_end=f.x;b.pos_y_end=f.y;b.pos_t_delta=f.t-b.pos_t_start;a=null===b.pos_x_previous?0:f.x-
b.pos_x_previous;c=null===b.pos_y_previous?0:f.y-b.pos_y_previous;b.pos_x_delta+=Math.abs(a);b.pos_y_delta+=Math.abs(c);b.pos_u_delta+=Math.sqrt(a*a+c*c);b.dist_x=f.x-b.pos_x_start;b.dist_y=f.y-b.pos_y_start;b.dist_u=Math.sqrt(b.dist_x*b.dist_x+b.dist_y*b.dist_y);b.vel_x=b.dist_x/b.pos_t_delta;b.vel_y=b.dist_y/b.pos_t_delta;b.vel_u=b.dist_u/b.pos_t_delta;l.event("touchend",b);"mouseleave"!==g.type&&"touchleave"!==g.type&&b.pos_t_delta<n.TAP_MAXTIME&&b.pos_u_delta<n.TAP_MAXDELTA&&(l.event("tap",b),
g.preventDefault());b.pos_t_delta<n.SWIPE_MAXTIME&&b.vel_u>n.SWIPE_MINSPEED&&(Math.abs(b.dist_x)>Math.abs(b.dist_y)?b.direction=0<b.dist_x?"RIGHT":"LEFT":b.direction=0<b.dist_y?"DOWN":"UP",l.event("swipe",b));d()}}function m(){c.addEventListener("touchstart",a,!1);c.addEventListener("mousedown",a,!1);c.addEventListener("touchmove",k,!1);c.addEventListener("mousemove",k,!1);document.body.addEventListener("touchcancel",h,!1);document.body.addEventListener("mouseup",h,!1);document.body.addEventListener("touchend",
h,!1)}var l=this,g=null,p=c.style,n={TAP_MAXTIME:500,TAP_MAXDELTA:20,PAN_MINDELTA:20,SWIPE_MAXTIME:400,SWIPE_MINSPEED:1},f={x:null,y:null,t:null},b={pos:f,event:null,preventDefault:function(){g&&g.cancellable&&g.preventDefault()},stopProgagation:function(){g&&g.stopProgagation&&g.stopProgagation()}};p.webkitUserSelect="none";p.mozUserSelect="none";p.msUserSelect="none";p.webkitUserDrag="none";p.webkitTapHighlightColor="rgba(0,0,0,0)";d();m();this.__eventlist__={};this.detach=function(){c.removeEventListener("touchstart",
a,!1);c.removeEventListener("mousedown",a,!1);c.removeEventListener("touchmove",k,!1);c.removeEventListener("mousemove",k,!1);document.body.removeEventListener("touchcancel",h,!1);document.body.removeEventListener("mouseup",h,!1);document.body.removeEventListener("touchend",h,!1)};this.attach=m;this.element=c;this.CONFIG=n;c.touches=this}function h(c){var d,e,a;if("object"!==typeof c)throw Error("Element object structure is not defined");if("string"===typeof c.alloyName)if(e=c.alloyName,a=c.alloyProperties||
{},l[e])a=new l[e](a),a.alloyName=e,a.element.alloy=a,a=a.element;else throw Error("Construction Error, alloy does not exist");else a="string"===typeof c.tagName?document.createElement(c.tagName):document.createElement("div");for(d in c)switch(e=c[d],d){case "tagName":case "alloyName":case "alloyProperties":case "copies":break;case "ontap":m(a,"tap",e);break;case "onswipe":m(a,"swipe",e);break;case "onpan":m(a,"pan",e);break;case "parentNode":e.appendChild(a);break;case "style":if("object"===typeof e)for(d in e)a.style[d]=
e[d];else if("string"===typeof e)a.style.cssText=e;else throw Error("Style TypeError - "+typeof e);break;case "dataset":for(d in e)a.dataset[d]=e[d];break;case "childNodes":for(d=0;d<e.length;d++)if(e[d]instanceof HTMLElement)a.appendChild(e[d]);else if("object"===typeof e[d])e[d].parentNode=a,e[d]=h(e[d]);else throw Error("Child "+d+" TypeError - "+typeof e[d]);break;case "childNode":if(e instanceof HTMLElement)a.appendChild(e);else if("object"===typeof e)e.parentNode=a,h(e);else throw Error("Child TypeError - "+
typeof e);break;default:a[d]=e}return a}function m(c,d,e){c.touches||new k(c);c.touches.on(d,e)}var l={};k.prototype={on:function(c,d){this.__eventlist__[c.toLowerCase()]=d},event:function(c,d){if("function"===typeof this.__eventlist__[c])try{this.__eventlist__[c].call(this,d)}catch(e){console.warn(e.stack||e)}}};window.Doom={create:h,modify:function(c){var d=c.element,e,a;if(!d)throw Error("Element not defined");for(a in c)switch(e=c[a],a){case "tagName":case "alloyName":case "alloyProperties":case "copies":break;
case "ontap":m(d,"tap",e);break;case "onswipe":m(d,"swipe",e);break;case "onpan":m(d,"pan",e);break;case "parentNode":e.appendChild(d);break;case "addClass":d.classList.add(e);break;case "toggleClass":d.classList.toggle(e);break;case "removeClass":d.classList.remove(e);break;case "dataset":for(a in e)d.dataset[a]=e[a];break;case "style":if("object"===typeof e)for(a in c.style)d.style[a]=c.style[a];else if("string"===typeof c.style)d.style.cssText+=c.style;else throw Error("Style TypeError - "+typeof c.style);
break;case "innerHTML":d[a]!==c[a]&&(d[a]=c[a]);break;case "removeChild":"number"===typeof c[a]?d.removeChild(d.childNodes[c[a]]):d.removeChild(c[a]);break;case "removeChildren":for(e=c[a].length;a--;)"number"===typeof c[a][e]&&(c[a][e]=d.childNodes[c[a][e]]);for(e=c[a].length;a--;)d.removeChild(c[a][e]);break;case "appendChild":break;case "childNodes":for(;d.firstChild;)d.removeChild(d.firstChild);for(a=0;a<c.childNodes.length;a++)if(c.childNodes[a]instanceof HTMLElement)d.appendChild(c.childNodes[a]);
else if("object"==typeof c.childNodes[a])c.childNodes[a].parentNode=d,c.childNodes[a]=h(c.childNodes[a]);else throw Error("Child "+a+" TypeError - "+typeof c.childNodes[a]);break;default:d[a]=c[a]}return d},search:function(c,d){d=d||document;switch(c.charAt(0)){case ".":return d.getElementsByClassName(c.substr(1));case "#":return d.getElementById(c.substr(1));case "?":return d.querySelectorAll(c.substr(1));default:return d.getElementsByTagName(c)}},remove:function(c){c.parentNode&&c.parentNode.removeChild(c);
return c},define:function(c,d){c=c.toLowerCase();if(l[c])throw Error("Definition Error, alloy already exists!");l[c]=d},touch:m}})();
